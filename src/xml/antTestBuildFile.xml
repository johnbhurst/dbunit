<?xml version="1.0"?>

<project name="ant-test" basedir="../../" default="all">

  <property file="profile.properties"/>

  <property name="testDataSet" value="src/xml/antTestDataSet.xml"/>
  <property name="exportDataSet" value="src/xml/antExportDataSet.xml"/>
  <property name="exportDtd" value="src/xml/antExport.dtd"/>
  <property name="exportCsv" value="src/xml/antExportCsv"/>

  <taskdef name="dbunit" classname="org.dbunit.ant.DbUnitTask"/>
  
  <target name="all" depends="no-driver, no-db-url, no-userid, no-password"/>

  <target name="no-driver">
    <dbunit url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="CLEAN_INSERT" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="no-db-url">
    <dbunit driver="${dbunit.profile.driverClass}"
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="CLEAN_INSERT" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="no-userid">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
       
            password="${dbunit.profile.password}">
      <operation type="CLEAN_INSERT" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="no-password">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}">
      <operation type="CLEAN_INSERT" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="invalid-db-info">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="jdbc:foobar://localhost/dbunittest" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="CLEAN_INSERT" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="set-format-xml">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="INSERT" src="${testDataSet}" format="xml"/>
    </dbunit>
  </target>

  <target name="set-type-none">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="NONE" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="set-type-insert">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}"
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="INSERT" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="set-type-update">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="UPDATE" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="set-type-refresh">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="REFRESH" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="set-type-delete">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="DELETE" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="set-type-delete-all">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="DELETE_ALL" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="set-type-clean-insert">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="CLEAN_INSERT" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="set-type-mssql-insert">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="MSSQL_INSERT" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="set-type-mssql-refresh">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="MSSQL_REFRESH" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="set-type-mssql-clean-insert">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="MSSQL_CLEAN_INSERT" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="invalid-type">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <operation type="CLEAN_INSERT" src="${testDataSet}"/>
      <operation type="DELETE" src="${testDataSet}"/>
      <operation type="RIDICULOUS" src="${testDataSet}"/>
    </dbunit>
  </target>

  <target name="composite-tests">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <composite src="${testDataSet}" format="xml">
        <operation type="CLEAN_INSERT"/>
        <operation type="DELETE"/>
      </composite>
    </dbunit>
  </target>

  <target name="invalid-composite-operation-src">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <composite src="${testDataSet}" format="xml">
        <operation type="CLEAN_INSERT" src="${testDataSet}"/>
        <operation type="DELETE"/>
      </composite>
    </dbunit>
  </target>

  <target name="invalid-composite-operation-format-xml">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <composite src="${testDataSet}">
        <operation type="CLEAN_INSERT" format="xml"/>
        <operation type="DELETE"/>
      </composite>
    </dbunit>
  </target>

  <target name="test-export-full">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <export dest="${exportDataSet}"/>
    </dbunit>
    <delete file="${exportDataSet}"/>
  </target>

  <target name="test-export-partial">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <export dest="${exportDataSet}">
        <table name="TEST_TABLE"/>
        <table name="PK_TABLE"/>
      </export>
    </dbunit>
    <delete file="${exportDataSet}"/>
  </target>

  <target name="test-export-format-flat">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <export dest="${exportDataSet}" format="flat"/>
    </dbunit>
    <delete file="${exportDataSet}"/>
  </target>

  <target name="test-export-format-xml">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <export dest="${exportDataSet}" format="xml"/>
    </dbunit>
    <delete file="${exportDataSet}"/>
  </target>

  <target name="test-export-format-dtd">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <export dest="${exportDtd}" format="dtd"/>
    </dbunit>
    <delete file="${exportDtd}"/>
  </target>

  <target name="test-export-format-csv">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}"
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <export dest="${exportCsv}" format="csv"/>
    </dbunit>
    <delete file="${exportCsv}"/>
  </target>

  <target name="invalid-export-format">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
        userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <export dest="${exportDtd}" format="invalid"/>
    </dbunit>
  </target>
  
  <target name="test-export-query">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
            userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <export dest="${exportDataSet}">
        <query name="TEST_TABLE" sql="SELECT * FROM test_table"/>
        <query name="PK_TABLE" sql="SELECT * FROM pk_table"/>
      </export>
    </dbunit>
    <delete file="${exportDataSet}"/>
  </target>

  <target name="test-export-query-mixed">
    <dbunit driver="${dbunit.profile.driverClass}"
            url="${dbunit.profile.connectionUrl}" 
            userid="${dbunit.profile.user}"
            password="${dbunit.profile.password}">
      <export dest="${exportDataSet}">
        <table name="TEST_TABLE" />
        <query name="PK_TABLE" sql="SELECT * FROM pk_table WHERE normal1='0 wor'"/>
      </export>
    </dbunit>
    <delete file="${exportDataSet}"/>
  </target>
  
  <target name="test-classpath">
    <dbunit driver="org.gjt.mm.mysql.Driver"
            url="jdbc:mysql://localhost:3306/dbunit"
            userid="root"
            password="">
      <operation type="INSERT" src="${testDataSet}" format="xml"/>
      <classpath>    	
      	<pathelement location="./lib/mm.mysql-2.0.11-bin.jar"/>
      </classpath>
    </dbunit>
  </target>  

  <target name="test-drivernotinclasspath">
    <dbunit driver="org.gjt.mm.mysql.Driver"
            url="jdbc:mysql://localhost:3306/dbunit"
            userid="root"
            password="">
      <operation type="INSERT" src="${testDataSet}" format="xml"/>
      <classpath>
      	<pathelement location="./lib/unknown.jar"/>
      </classpath>
    </dbunit>
  </target>

    <target name="test-datatypefactory">
      <dbunit driver="${dbunit.profile.driverClass}"
              datatypeFactory="org.dbunit.ext.oracle.OracleDataTypeFactory"
              url="${dbunit.profile.connectionUrl}"
              userid="${dbunit.profile.user}"
              password="${dbunit.profile.password}">
          <operation type="NONE"/>
      </dbunit>
    </target>

    <target name="test-escapepattern">
      <dbunit driver="${dbunit.profile.driverClass}"
              escapePattern="[?]"
              url="${dbunit.profile.connectionUrl}"
              userid="${dbunit.profile.user}"
              password="${dbunit.profile.password}">
          <operation type="NONE" src="${testDataSet}"/>
      </dbunit>
    </target>

</project>

