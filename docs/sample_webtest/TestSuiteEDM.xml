<!DOCTYPE project [
  <!ENTITY sharedConfiguration SYSTEM "./includes/sharedConfiguration.xml">
   
]>


<project name="TestSuiteEDM" default="testSuite">
  <!-- Allow any user specific values to override the defaults -->
  <property file="${user.home}/build.properties" />

  <property file="project.properties"/>
  <property file="build.properties"/>
  



  <property name="resultfile" value="WebTestResults.xml"/>
  <property name="resultfile.txt" value="WebTestResults.txt"/>
  <property name="resultfile.html" value="WebTestResults.html"/>
  <property name="start.page" value="menu.jsp"/>
  <property name="base.dir" value="${basedir}"/>
  
    <taskdef name="dbunit" classname="org.dbunit.ant.DbUnitTask">
        <classpath>
            <fileset dir="${dbunit.classpath}" includes="dbunit.jar"/>
            <fileset dir="${dbunit.classpath}" includes="exml.jar"/>
        </classpath>
  </taskdef>



<target name="testSuite">

  <antcall target="subscribeEmailAddressWithOptedOutEmail"/>
  <antcall target="subscribeEmailAddressWithNewEmailAddress"/>
  <antcall target="subscribeEmailAddressWithInvalidEmailAddress"/>
  
</target>


<target name="subscribeEmailAddressWithNewEmailAddress">
  <sql
        driver="${sql.jdbcdriver}"
        url="${sql.url}"
        userid="${sql.username}"
        password="${sql.password}">
      UPDATE email set email='subscribeEmailAddressWithNewEmailAddress@test.com' + convert(varchar(10),email_id)
      WHERE email='test@test.com'

  </sql>
  <testSpec name="subscribeEmailAddressWithNewEmailAddress">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/edm/subscribe.asp?e=test@test.com"
        save="subscribeEmailAddressWithNewEmailAddress"/>
      <verifytext stepid="Make sure we recieved the success message"
        text="You have been subscribed to the Upstate mailing list"/>       
          
    </steps>
  </testSpec>                             
</target> 

<target name="subscribeEmailAddressWithOptedOutEmail">
  <dbunit 
      driver="${sql.jdbcdriver}"          
      url="${sql.url}"          
      userid="${sql.username}"          
      password="${sql.password}">    
          <operation type="MSSQL_REFRESH" src="data/subscribeEmailAddressWithOptedOutEmail.xml" format="flat"/>
  </dbunit>
  <testSpec name="subscribeEmailAddressWithOptedOutEmail">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/edm/subscribe.asp?e=subscribeEmailAddressWithOptedOutEmail@test.com"
        save="subscribeEmailAddressWithNewEmailAddress"/>
      <verifytext stepid="Make sure we recieved the success message"
        text="You have been subscribed to the Upstate mailing list"/>       
          
    </steps>
  </testSpec>                             
</target> 

<target name="subscribeEmailAddressWithInvalidEmailAddress">
  <testSpec name="subscribeEmailAddressWithInvalidEmailAddress">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/edm/subscribe.asp?e=subscribeEmailAddressWithInvalidEmailAddress"
        save="subscribeEmailAddressWithInvalidEmailAddress"/>
      <verifytext stepid="Make sure we recieved the failure message"
        text="We're sorry, but your email address appears to not be a valid email address."/>       
      <invoke stepid="main page"
              url="/edm/subscribe.asp?e=44"
        save="subscribeEmailAddressWithInvalidEmailAddress2"/>
      <verifytext stepid="Make sure we recieved the failure message"
        text="We're sorry, but your email address appears invalid."/>            
    </steps>
  </testSpec>                             
</target> 

</project>