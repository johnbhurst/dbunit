<!DOCTYPE project [
  <!ENTITY sharedConfiguration SYSTEM "./includes/sharedConfiguration.xml">
  <!ENTITY invokeHome   SYSTEM "file:./includes/invokeHome.xml">
  

  

  
]>


<project name="TestSuiteEDM" default="testSuite">
  <!-- Allow any user specific values to override the defaults -->
  <property file="${user.home}/build.properties" />

  <property file="project.properties"/>
  <property file="build.properties"/>
  



  <property name="resultfile" value="WebTestResults.xml"/>
  <property name="resultfile.txt" value="WebTestResults.txt"/>
  <property name="resultfile.html" value="WebTestResults.html"/>
  <property name="start.page" value="menu.jsp"/>
  <property name="base.dir" value="${basedir}"/>
  
    <taskdef name="dbunit" classname="org.dbunit.ant.DbUnitTask">
        <classpath>
            <fileset dir="${dbunit.classpath}" includes="dbunit.jar"/>
            <fileset dir="${dbunit.classpath}" includes="exml.jar"/>
        </classpath>
  </taskdef>



<target name="testSuite">
  <antcall target="sniffTest"/>
  <antcall target="userWithNoRedirectionID"/>
  <antcall target="userWithRedirectionIDOldStyle"/>
  <antcall target="userWithRedirectionID"/>
  <antcall target="userWithRedirectionIDBadEmailOldStyle"/>
  <antcall target="userWithRedirectionIDBadEmail"/>
  
  <antcall target="userWithExistingEmailAddress"/>
  <antcall target="userWithExistingEmailAddressOldStyle"/>
  <antcall target="userWithNewEmailAddress"/>
  <antcall target="userWithNewEmailAddressOldStyle"/>
  
  <antcall target="userWithCampaignId"/>
  <antcall target="userWithEverythingRedirectToProduct"/>
  <antcall target="userWithEverythingRedirectToProductOldStyle"/>
  
  <antcall target="redirectToExternalWebsite"/>
  <antcall target="redirectToExternalWebsiteOldStyle"/>
  <antcall target="redirectionURLEndingInSlash"/>
  
  <antcall target="unsubscribeWithBadEmailId"/>
  <antcall target="unsubscribeWithNoParameters"/>
  <antcall target="unsubscribeWithInvalidEmail"/>

  <antcall target="unsubscribeEmailAddressWithEmail"/>
  <antcall target="unsubscribeEmailAddressWithEmailID"/>
  <antcall target="unsubscribeEmailAddressWithNewEmailAddress"/>
  
  <antcall target="subscribeEmailAddressWithOptedOutEmail"/>
  <antcall target="subscribeEmailAddressWithNewEmailAddress"/>
  <antcall target="subscribeEmailAddressWithInvalidEmailAddress"/>
  
  <antcall target="productWithCustomCOAHeader"/>
  <!-- NO PRODUCT CURRENTLY AVAILABLE
  <antcall target="productWithPartnerLink"/>
  -->
  
</target>


<target name="userWithNoRedirectionID">
  <testSpec name="userWithNoRedirectionID">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="${r.page}"
        save="userWithNoRedirectionID"/>
      <verifytext stepid="Make sure we are on the homepage"
        text="Our Newest Product Releases"/>            
        
    </steps>
  </testSpec>                             
</target>

<target name="userWithRedirectionIDOldStyle">
  <dbunit 
    driver="${sql.jdbcdriver}"          
    url="${sql.url}"          
    userid="${sql.username}"          
    password="${sql.password}">    
        <operation type="MSSQL_REFRESH" src="data/userWithRedirectionID.xml" format="flat"/>
  </dbunit>

  <testSpec name="userWithRedirectionIDOldStyle">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="${r.page}?r=1"
        save="userWithRedirectionID"/>
      <verifytext stepid="Make sure we are redirected to the upstate info page"
        text="Upstate develops the most innovative products"/>  
      
    </steps>
  </testSpec>                             
</target>

<target name="userWithRedirectionID">
  <dbunit 
    driver="${sql.jdbcdriver}"          
    url="${sql.url}"          
    userid="${sql.username}"          
    password="${sql.password}">    
        <operation type="MSSQL_REFRESH" src="data/userWithRedirectionID.xml" format="flat"/>
  </dbunit>

  <testSpec name="userWithRedirectionID">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="r.q.r.e.1"
        save="userWithRedirectionID"/>
      <verifytext stepid="Make sure we are redirected to the upstate info page"
        text="Upstate develops the most innovative products"/>  
      
    </steps>
  </testSpec>                             
</target>

<target name="userWithRedirectionIDBadEmail">
  <dbunit 
    driver="${sql.jdbcdriver}"          
    url="${sql.url}"          
    userid="${sql.username}"          
    password="${sql.password}">    
        <operation type="MSSQL_REFRESH" src="data/userWithRedirectionIDBadEmail.xml" format="flat"/>
  </dbunit>


  <testSpec name="userWithRedirectionIDBadEmail">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/r.q.r.e.1.a.e.e.userWithRedirectionIDBadEmail"
        save="userWithRedirectionIDBadEmail"/>
      <verifytext stepid="Make sure we are redirected to the upstate info page despite the bad email"
        text="Upstate develops the most innovative products"/>  
      
    </steps>
  </testSpec>                             
</target>

<target name="userWithRedirectionIDBadEmailOldStyle">
  <dbunit 
    driver="${sql.jdbcdriver}"          
    url="${sql.url}"          
    userid="${sql.username}"          
    password="${sql.password}">    
        <operation type="MSSQL_REFRESH" src="data/userWithRedirectionIDBadEmail.xml" format="flat"/>
  </dbunit>


  <testSpec name="userWithRedirectionIDBadEmailOldStyle">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="${r.page}?r=1&amp;e=userWithRedirectionIDBadEmail"
        save="userWithRedirectionIDBadEmail"/>
      <verifytext stepid="Make sure we are redirected to the upstate info page despite the bad email"
        text="Upstate develops the most innovative products"/>  
      
    </steps>
  </testSpec>                             
</target>

<target name="redirectionURLEndingInSlash">
  <dbunit 
    driver="${sql.jdbcdriver}"          
    url="${sql.url}"          
    userid="${sql.username}"          
    password="${sql.password}">    
        <operation type="MSSQL_REFRESH" src="data/redirectionURLEndingInSlash.xml" format="flat"/>
  </dbunit>


  <testSpec name="redirectionURLEndingInSlash">
    &sharedConfiguration;
    <steps>
      <invoke stepid="redirection url ending in a slash"
              url="${r.page}?r=1/"
        save="redirectionURLEndingInSlash"/>
      <verifytext stepid="Make sure we are redirected to the upstate info page"
        text="Upstate develops the most innovative products"/> 
        
    </steps>
  </testSpec>                             
</target>


<target name="userWithExistingEmailAddressOldStyle">
  <dbunit 
      driver="${sql.jdbcdriver}"          
      url="${sql.url}"          
      userid="${sql.username}"          
      password="${sql.password}">    
          <operation type="MSSQL_REFRESH" src="data/userWithExistingEmailAddress.xml" format="flat"/>
  </dbunit>
  <testSpec name="userWithExistingEmailAddressOldStyle">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="${r.page}?r=1&amp;e=1"
        save="userWithExistingEmailAddress"/>
      <verifytext stepid="Make sure we are redirected to the upstate info page"
        text="Upstate develops the most innovative products"/>       
          
    </steps>
  </testSpec>                             
</target>

<target name="userWithExistingEmailAddress">
  <dbunit 
      driver="${sql.jdbcdriver}"          
      url="${sql.url}"          
      userid="${sql.username}"          
      password="${sql.password}">    
          <operation type="MSSQL_REFRESH" src="data/userWithExistingEmailAddress.xml" format="flat"/>
  </dbunit>
  <testSpec name="userWithExistingEmailAddress">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/r.q.r.e.1.a.e.e.1"
        save="userWithExistingEmailAddress"/>
      <verifytext stepid="Make sure we are redirected to the upstate info page"
        text="Upstate develops the most innovative products"/>       
          
    </steps>
  </testSpec>                             
</target>

<target name="userWithNewEmailAddress">
  <testSpec name="userWithNewEmailAddress">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/r.q.e.e.test@test.com.a.r.e.1"
        save="userWithNewEmailAddress"/>          
      <verifytext stepid="Make sure we are redirected to the upstate info page"
        text="Upstate develops the most innovative products"/>       
    </steps>
    
  </testSpec>                             
</target>
<target name="userWithNewEmailAddressOldStyle">
  <testSpec name="userWithNewEmailAddressOldStyle">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="${r.page}?e=test@test.com&amp;r=1"
        save="userWithNewEmailAddressOldStyle"/>          
      <verifytext stepid="Make sure we are redirected to the upstate info page"
        text="Upstate develops the most innovative products"/>       
    </steps>
    
  </testSpec>                             
</target>
<target name="userWithCampaignId">
  <dbunit 
      driver="${sql.jdbcdriver}"          
      url="${sql.url}"          
      userid="${sql.username}"          
      password="${sql.password}">    
          <operation type="MSSQL_REFRESH" src="data/userWithCampaignId.xml" format="flat"/>
  </dbunit>
  <testSpec name="userWithCampaignId">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="${r.page}?r=1&amp;e=1&amp;c=1"
        save="userWithCampaignId"/>
      <verifytext stepid="Make sure we are redirected to the upstate info page"
        text="Upstate develops the most innovative products"/>       
          
    </steps>
  </testSpec>                             
</target>

<target name="userWithEverythingRedirectToProduct">
  <dbunit 
      driver="${sql.jdbcdriver}"          
      url="${sql.url}"          
      userid="${sql.username}"          
      password="${sql.password}">    
          <operation type="MSSQL_REFRESH" src="data/userWithEverythingRedirectToProduct.xml" format="flat"/>
  </dbunit>
  <testSpec name="userWithEverythingRedirectToProduct">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/r.q.r.e.2.a.e.e.2.a.c.e.2"
        save="userWithEverythingRedirectToProduct"/>
      <verifytext stepid="Make sure we are redirected to the Anti-Striatin page"
        text="Anti-Striatin"/>       
          
    </steps>
  </testSpec>                             
</target>

<target name="userWithEverythingRedirectToProductOldStyle">
  <dbunit 
      driver="${sql.jdbcdriver}"          
      url="${sql.url}"          
      userid="${sql.username}"          
      password="${sql.password}">    
          <operation type="MSSQL_REFRESH" src="data/userWithEverythingRedirectToProduct.xml" format="flat"/>
  </dbunit>
  <testSpec name="userWithEverythingRedirectToProductOldStyle">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="${r.page}?r=2&amp;e=2&amp;c=2"
        save="userWithEverythingRedirectToProductOldStyle"/>
      <verifytext stepid="Make sure we are redirected to the Anti-Striatin page"
        text="Anti-Striatin"/>       
          
    </steps>
  </testSpec>                             
</target>


<target name="redirectToExternalWebsite">
  <dbunit 
      driver="${sql.jdbcdriver}"          
      url="${sql.url}"          
      userid="${sql.username}"          
      password="${sql.password}">    
          <operation type="MSSQL_REFRESH" src="data/redirectToExternalWebsite.xml" format="flat"/>
  </dbunit>
  <testSpec name="redirectToExternalWebsite">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="${r.page}?r=3"
        save="redirectToExternalWebsite"/>
      <verifytext stepid="Make sure we are redirected to the Sun website"
        text="Sun"/>       
          
    </steps>
  </testSpec>                             
</target>

<target name="redirectToExternalWebsiteOldStyle">
  <dbunit 
      driver="${sql.jdbcdriver}"          
      url="${sql.url}"          
      userid="${sql.username}"          
      password="${sql.password}">    
          <operation type="MSSQL_REFRESH" src="data/redirectToExternalWebsite.xml" format="flat"/>
  </dbunit>
  <testSpec name="redirectToExternalWebsiteOldStyle">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="${r.page}?r=3"
        save="redirectToExternalWebsite"/>
      <verifytext stepid="Make sure we are redirected to the Sun website"
        text="Sun"/>       
          
    </steps>
  </testSpec>                             
</target>

<target name="unsubscribeWithBadEmailId">
  <testSpec name="unsubscribeWithBadEmailId">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/edm/unsubscribe.asp?e=9999999"
        save="unsubscribeWithBadEmailId"/>
      <verifytext stepid="Make sure we recieved the error message"
        text="We're sorry, but your email address could not be located."/>       
          
    </steps>
  </testSpec>                             
</target>

<target name="unsubscribeWithNoParameters">
  <testSpec name="unsubscribeWithNoParameters">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/edm/unsubscribe.asp"
        save="unsubscribeWithNoParameters"/>
      <verifytext stepid="Make sure we recieved the error message"
        text="We're sorry, but your email address could not be located."/>       
          
    </steps>
  </testSpec>                             
</target>

<target name="unsubscribeWithInvalidEmail">
  <testSpec name="unsubscribeWithInvalidEmail">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/edm/unsubscribe.asp?e=unsubscribeWithInvalidEmail"
        save="unsubscribeWithInvalidEmail"/>
      <verifytext stepid="Make sure we recieved the error message"
        text="We're sorry, but your email address could not be located."/>       
          
    </steps>
  </testSpec>                             
</target>
         
<target name="unsubscribeEmailAddressWithEmail">
  <dbunit 
      driver="${sql.jdbcdriver}"          
      url="${sql.url}"          
      userid="${sql.username}"          
      password="${sql.password}">    
          <operation type="MSSQL_REFRESH" src="data/unsubscribeEmailAddressWithEmail.xml" format="flat"/>
  </dbunit>
  <testSpec name="unsubscribeEmailAddress">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/edm/unsubscribe.asp?e=userWithExistingEmailAddress@test.com"
        save="unsubscribeEmailAddress"/>
      <verifytext stepid="Make sure we recieved the success message"
        text="You have been removed from the Upstate mailing list."/>       
          
    </steps>
  </testSpec>                             
</target>         

<target name="unsubscribeEmailAddressWithEmailID">
  <dbunit 
      driver="${sql.jdbcdriver}"          
      url="${sql.url}"          
      userid="${sql.username}"          
      password="${sql.password}">    
          <operation type="MSSQL_REFRESH" src="data/unsubscribeEmailAddressWithEmailID.xml" format="flat"/>
  </dbunit>
  <testSpec name="unsubscribeEmailAddressWithEmailID">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/edm/unsubscribe.asp?e=1"
        save="unsubscribeEmailAddressWithEmailID"/>
      <verifytext stepid="Make sure we recieved the success message"
        text="You have been removed from the Upstate mailing list."/>       
          
    </steps>
  </testSpec>                             
</target> 

<target name="unsubscribeEmailAddressWithNewEmailAddress">
  <sql
        driver="${sql.jdbcdriver}"
        url="${sql.url}"
        userid="${sql.username}"
        password="${sql.password}">
      UPDATE email set email='unsubscribeEmailAddressWithNewEmailAddress@test.com' + convert(varchar(10),email_id)
      WHERE email='test@test.com'

  </sql>
  <testSpec name="unsubscribeEmailAddressWithNewEmailAddress">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/edm/unsubscribe.asp?e=test@test.com"
        save="unsubscribeEmailAddressWithNewEmailAddress"/>
      <verifytext stepid="Make sure we recieved the success message"
        text="You have been removed from the Upstate mailing list."/>       
          
    </steps>
  </testSpec>                             
</target> 


<target name="subscribeEmailAddressWithNewEmailAddress">
  <sql
        driver="${sql.jdbcdriver}"
        url="${sql.url}"
        userid="${sql.username}"
        password="${sql.password}">
      UPDATE email set email='subscribeEmailAddressWithNewEmailAddress@test.com' + convert(varchar(10),email_id)
      WHERE email='test@test.com'

  </sql>
  <testSpec name="subscribeEmailAddressWithNewEmailAddress">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/edm/subscribe.asp?e=test@test.com"
        save="subscribeEmailAddressWithNewEmailAddress"/>
      <verifytext stepid="Make sure we recieved the success message"
        text="You have been subscribed to the Upstate mailing list"/>       
          
    </steps>
  </testSpec>                             
</target> 

<target name="subscribeEmailAddressWithOptedOutEmail">
  <dbunit 
      driver="${sql.jdbcdriver}"          
      url="${sql.url}"          
      userid="${sql.username}"          
      password="${sql.password}">    
          <operation type="MSSQL_REFRESH" src="data/subscribeEmailAddressWithOptedOutEmail.xml" format="flat"/>
  </dbunit>
  <testSpec name="subscribeEmailAddressWithOptedOutEmail">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/edm/subscribe.asp?e=subscribeEmailAddressWithOptedOutEmail@test.com"
        save="subscribeEmailAddressWithNewEmailAddress"/>
      <verifytext stepid="Make sure we recieved the success message"
        text="You have been subscribed to the Upstate mailing list"/>       
          
    </steps>
  </testSpec>                             
</target> 

<target name="subscribeEmailAddressWithInvalidEmailAddress">
  <testSpec name="subscribeEmailAddressWithInvalidEmailAddress">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="/edm/subscribe.asp?e=subscribeEmailAddressWithInvalidEmailAddress"
        save="subscribeEmailAddressWithInvalidEmailAddress"/>
      <verifytext stepid="Make sure we recieved the failure message"
        text="We're sorry, but your email address appears to not be a valid email address."/>       
      <invoke stepid="main page"
              url="/edm/subscribe.asp?e=44"
        save="subscribeEmailAddressWithInvalidEmailAddress2"/>
      <verifytext stepid="Make sure we recieved the failure message"
        text="We're sorry, but your email address appears invalid."/>            
    </steps>
  </testSpec>                             
</target> 

<target name="productWithCustomCOAHeader">
  <testSpec name="productWithCustomCOAHeader">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="${start.page}"
        save="productWithCustomCOAHeader"/>
      <setinputfield stepid="search for test product 14-000"
        name="query"
        value="14-000"/>
      <clickbutton stepid="Click link to Execute QuickSearch"
        name="imageField"/>
      <verifytitle stepid="Make sure we are on product 14-000"
        text="Upstate - Product #14-000 - TEST ( 14000 )"/>  
      <not>
        <verifytext stepid="Make sure there is no COA message."
          text="Certificate of Analysis:"/>       
      </not>
      <verifytext stepid="Make sure there is a Product Description message."
        text="PRODUCT DESCRIPTION:"/>             
    </steps>
  </testSpec>                             
</target> 

<target name="productWithPartnerLink">
  <testSpec name="productWithPartnerLink">
    &sharedConfiguration;
    <steps>
      <invoke stepid="main page"
              url="${start.page}"
        save="productWithPartnerLink"/>
      <setinputfield stepid="search for test product 14-000"
        name="query"
        value="14-000"/>
      <clickbutton stepid="Click link to Execute QuickSearch"
        name="imageField"/>
      <verifytitle stepid="Make sure we are on product 14-000"
        text="Upstate - Product #14-000 - TEST ( 14000 )"/>  
     
      <verifytext stepid="Make sure there is a link to Molecular Devices."
        text="Also available from Molecular Devices Corp."/>             
    </steps>
  </testSpec>                             
</target> 

<target name="sniffTest">                                 
  <testSpec name="Sniff">
    &sharedConfiguration;
    <steps>
      &invokeHome;
    </steps>
  </testSpec>                             
</target>

</project>