 
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><!-- #BeginTemplate "/Templates/main.dwt" -->
<head>
<meta http-equiv="Content-Style-Type" content="text/css">
<link href="stylesheet.css" rel="stylesheet" type="text/css">
<!-- #BeginEditable "doctitle" --> 
<title>The Dbunit Framework - Framework Components</title>
<!-- #EndEditable --> 
</head>
<body>
<table cellspadding = 0 cellspacing = 0 border = 0 width="100%">
  <tr height="100"> 
    <td class="logo" width = 200><img src="images/logo.jpg" width=200 height=100></td>
    <td class="header"></td>
  </tr>
  </table>
  <table cellspadding = 0 cellspacing = 0 border = 0>
    <tr> 
      <td class="menu" nowrap valign="top" > <a href="index.html">Home</a><br>
        <br>
        <a href="components.html">Components</a><br>
        <a href="howto.html">Howto Guides</a><br>
        <a href="bestpractices.html">Best Practices</a><br>
        <a href="api/index.html">API Reference</a><br>
        <a href="faq.html">FAQ</a><br>
        <br>
        <a href="changes.html">News/Changes</a><br>
        <a href="download.html">Download</a><br>
        <a href="support.html">Support</a><br>
        <a href="resources.html">Resources</a><br>
        <br>
        <div align="center"><a href="http://sourceforge.net"> <img alt="SourceForge Logo" border="0" height="31" width="88" src="http://sourceforge.net/sflogo.php?group_id=47439"> 
          </a></div>
        <br>
        <div align="center"><a href="http://www.silphid.com/"><img alt="Silphid Creations" 
      src="images/silphid.gif" border=0></a></div>
      </td>
      <td class="body" valign="top"> <!-- #BeginEditable "body" --> 
      <h2>Framework Components</h2>
      <p>Here is an introduction to the major Dbunit components: </p>
      <ul>
        <li><a href="#dataset">IDataSet</a></li>
        <ul>
          <li><a href="#XmlDataSet">XmlDataSet</a></li>
          <li><a href="#FlatXmlDataSet">FlatXmlDataSet</a></li>
          <li><a href="#DatabaseDataSet">DatabaseDataSet</a></li>
          <li><a href="#DefaultDataSet">DefaultDataSet</a></li>
          <li><a href="#CompositeDataSet">CompositeDataSet</a></li>
          <li><a href="#FilteredDataSet">FilteredDataSet</a></li>
        </ul>
        <li><a href="#databaseoperation">DatabaseOperation</a><br>
          <ul>
            <li><a href="#update">DatabaseOpratation.UPDATE</a></li>
            <li><a href="#insert">DatabaseOpratation.INSERT</a></li>
            <li><a href="#delete">DatabaseOpratation.DELETE</a></li>
            <li><a href="#deleteall">DatabaseOpratation.DELETE_ALL</a></li>
            <li><a href="#refresh">DatabaseOpratation.REFRESH</a></li>
            <li><a href="#cleaninsert">DatabaseOpratation.CLEAN_INSERT</a></li>
            <li><a href="#none">DatabaseOpratation.NONE</a></li>
            <li><a href="#CompositeOperation">CompositeOperation</a></li>
            <li><a href="#TransactionOperation">TransactionOperation</a></li>
          </ul>
        </li>
      </ul>
      <hr>
      <h3><a name="dataset">IDataSet</a></h3>
      The framework works abundantly with datasets. A dataset is a collection 
      of data from various tables. The Dbunit framework defines the IDataSet interface 
      and provides several implementations for it. <br>
      <br>
      The IDataSet interface:<br>
      <pre>
public interface IDataSet
{
    /**
     * Returns list of table names this dataset contains.
     */
    public String[] getTableNames() throws DataSetException;

    /**
     * Returns the specified table metatdata.
     */
    public ITableMetaData getTableMetaData(String tableName)
            throws DataSetException;

    /**
     * Returns the specified table.
     */
    public ITable getTable(String tableName) throws DataSetException;
}</pre>
      <h4><a name="XmlDataSet">XmlDataSet </a></h4>
      The XmlDataSet class provides the persistence support to read from and write 
      the original xml dataset format. A new xml dataset format has been introduced 
      in version 1.2 and it is strongly suggested that use it instead (see <a href="#FlatXmlDataSet">FlatXmlDataSet</a>).<br>
      <br>
      The original xml format dtd:<br>
      <pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!ELEMENT dataset (table+)&gt;
&lt;!ELEMENT table (column*, row*)&gt;
&lt;!ATTLIST table
    name CDATA #REQUIRED
&gt;
&lt;!ELEMENT column (#PCDATA)&gt;
&lt;!ELEMENT row (value | null | none)*&gt;
&lt;!ELEMENT value (#PCDATA)&gt;
&lt;!ELEMENT null EMPTY&gt;
&lt;!ELEMENT none EMPTY&gt;</pre>
      <br>
      <a name="originalxmlsample">And here is a sample instance:</a><br>
      <pre>
&lt;!DOCTYPE dataset SYSTEM &quot;dataset.dtd&quot;&gt;
&lt;dataset&gt;
    &lt;table name=&quot;TEST_TABLE&quot;&gt;
        &lt;column&gt;COLUMN0&lt;/column&gt;
        &lt;column&gt;COLUMN1&lt;/column&gt;
        &lt;column&gt;COLUMN2&lt;/column&gt;
        &lt;column&gt;COLUMN3&lt;/column&gt;
        &lt;row&gt;
            &lt;value&gt;row 0 col 0&lt;/value&gt;
            &lt;value&gt;row 0 col 1&lt;/value&gt;
            &lt;value&gt;row 0 col 2&lt;/value&gt;
            &lt;value&gt;row 0 col 3&lt;/value&gt;
        &lt;/row&gt;
        &lt;row&gt;
            &lt;value&gt;row 1 col 0&lt;/value&gt;
            &lt;null/&gt;
            &lt;null/&gt;
            &lt;value&gt;row 1 col 3&lt;/value&gt;
        &lt;/row&gt;
    &lt;/table&gt;
    &lt;table name=&quot;SECOND_TABLE&quot;&gt;
        &lt;column&gt;COLUMN0&lt;/column&gt;
        &lt;column&gt;COLUMN1&lt;/column&gt;
        &lt;row&gt;
            &lt;value&gt;row 0 col 0&lt;/value&gt;
            &lt;value&gt;row 0 col 1&lt;/value&gt;
        &lt;/row&gt;
        &lt;row&gt;
            &lt;value&gt;row 1 col 0&lt;/value&gt;
            &lt;value&gt;row 1 col 1&lt;/value&gt;
        &lt;/row&gt;
    &lt;/table&gt;
    &lt;table name='EMPTY_TABLE'&gt;
        &lt;column&gt;COLUMN0&lt;/column&gt;
        &lt;column&gt;COLUMN1&lt;/column&gt;
        &lt;column&gt;COLUMN2&lt;/column&gt;
        &lt;column&gt;COLUMN3&lt;/column&gt;
    &lt;/table&gt;
&lt;/dataset&gt;</pre>
      <h4><a name="FlatXmlDataSet">FlatXmlDataSet</a></h4>
      <p>This class has been introduced in version 1.2 and provides support for 
        the flat xml dataset format. I found that datasets authored with the original 
        xml format were hard to create and to maintain. This was particularly 
        painful for tables with several columns. </p>
      <p>Each xml element corresponds to a table row and. Each element name corresponds 
        to its table name. The columns correspond to attributes. This format has 
        no predefined DTD since it is different for each database. Fortunately, 
        you can easily generate a DTD for your database (see the <a href="howto.html#generatedtd">How 
        to documentation</a>). </p>
      <p> Here is a sample dataset containing the same data than the XmlDataSet 
        <a href="#originalxmlsample">sample</a>:<br>
      </p>
      <pre>&lt;dataset&gt;
    &lt;TEST_TABLE COLUMN0=&quot;row 0 col 0&quot; COLUMN1=&quot;row 0 col 1&quot; 
                COLUMN2=&quot;row 0 col 2&quot; COLUMN3=&quot;row 0 col 3&quot;/&gt;
    &lt;TEST_TABLE COLUMN0=&quot;row 1 col 0&quot; COLUMN3=&quot;row 1 col 3&quot;/&gt;
    &lt;SECOND_TABLE COLUMN0=&quot;row 0 col 0&quot; COLUMN1=&quot;row 0 col 1&quot; /&gt;
    &lt;SECOND_TABLE COLUMN0=&quot;row 1 col 0&quot; COLUMN1=&quot;row 1 col 1&quot; /&gt;
    &lt;EMPTY_TABLE/&gt;
&lt;/dataset&gt;
</pre>
      <h4><a name="DatabaseDataSet">DatabaseDataSet</a></h4>
      This is an adapter class used to access a database as a dataset.<br>
      <br>
      <h4><a name="DefaultDataSet">DefaultDataSet</a></h4>
      This class is backed by a List and is used to create datasets programmatically. 
      <br>
      <h4><a name="CompositeDataSet">CompositeDataSet</a></h4>
      This class combines multiple datasets into a single one at runtime.<br>
      <h4><a name="FilteredDataSet">FilteredDataSet</a></h4>
      <p>This is a decorator class which exposes only some tables from the decorated 
        dataset.<br>
      </p>
      <hr>
      <h3><a name="databaseoperation">DatabaseOperation</a></h3>
      The Dbunit framework uses dataset contents to perform operations on the 
      database before and after each test. The DatabaseOperation abstract class 
      defines such operations. Again, the framework provides several implementations. 
      <br>
      <br>
      The DatabaseOperation class: 
      <pre>
public abstract class DatabaseOperation
{
    public static final IDatabaseOperation NONE = new DummyAction();
    public static final IDatabaseOperation UPDATE = new UpdateOperation();
    public static final IDatabaseOperation INSERT = new InsertOperation();
    public static final IDatabaseOperation REFRESH = new RefreshOperation();
    public static final IDatabaseOperation DELETE = new DeleteOperation();
    public static final IDatabaseOperation DELETE_ALL = new DeleteAllOperation();
    public static final IDatabaseOperation CLEAN_INSERT = new CompositeOperation(
            DELETE_ALL, INSERT);

    public abstract void execute(IDatabaseConnection connection,
            IDataSet dataSet) throws DatabaseUnitException, SQLException;

    private static class DummyAction extends DatabaseOperation
    {
        public void execute(IDatabaseConnection connection, IDataSet dataSet)
        {
        }
    }
}</pre>
      <br>
      The two most important operations are REFRESH and CLEAN_INSERT. As you will 
      shortly understand, they are the ones you will deal with most of the time. 
      They represent two opposite testing strategies with different benefits and 
      tradeoffs. <br>
      <br>
      <h4><a name="update">DatabaseOperation</a>.UPDATE</h4>
      Updates the database from the dataset contents. This operation assumes that 
      table data already exists in the database and fails if this is not the case.<br>
      <br>
      <h4><a name="insert">DatabaseOperation.INSERT</a></h4>
      Inserts the dataset contents into the database. This operation assumes that 
      table data does not exist in the database and fails if this is not the case. 
      To prevent problems with foreign keys, tables must be sequenced appropriately 
      in dataset. <br>
      <br>
      <h4><a name="delete">DatabaseOperation.DELETE</a></h4>
      Deletes only the dataset contents from the database. This operation does 
      not delete the entire table contents but only data that are present in the 
      dataset. <br>
      <br>
      <h4><a name="deleteall">DatabaseOperation.DELETE_ALL</a></h4>
      Deletes entire database table contents for each table contained in dataset. 
      In other words, if a dataset does not contain a particular table, but that 
      table exists in the database, the contents of that table is not deleted. 
      Deletes are performed on table in reverse sequence.<br>
      <br>
      <h4><a name="refresh">DatabaseOperation.REFRESH</a></h4>
      This operation literally refreshes dataset contents into the database. This 
      means that data of existing rows is updated and non-existing row get inserted. 
      Any rows which exist in the database but not in dataset stay unaffected. 
      This approach is more appropriate for tests that assume other data may exist 
      in the database. <br>
      <br>
      As you understand, this is a very powerful operation. This strategy can 
      help you deal more easily with foreign key constraints, as you don't necessarily 
      need to insert data in a specific sequence. <br>
      <br>
      If they are correctly written, tests using this strategy can even be performed 
      on a populated database like a copy of a production database. <br>
      <br>
      <h4><a name="cleaninsert">DatabaseOperation.CLEAN_INSERT</a></h4>
      This is a composite operation that performs a DELETE_ALL operation followed 
      by an INSERT operation. This ensures that the database is in a known state. 
      This approach is more appropriate for tests that require the database to 
      only contain a specific set of data.<br>
      <br>
      <h4><a name="none">DatabaseOperation.NONE</a></h4>
      This operation does absolutely nothing with the database.<br>
      <br>
      <h4><a name ="CompositeOperation">CompositeOperation</a></h4>
      Combines multiple operations into a single one.<br>
      <br>
      <h4><a name="TransactionOperation">TransactionOperation</a></h4>
      Decorates an operation and executes within the context of a transaction.<br>
      <br>
      <!-- #EndEditable --> 
        <hr>
        <div align="center"> 
          <p><font size="2">Copyright &copy;2002, Manuel Laflamme, All Rights 
            Reserved</font></p>
          <p><font size="1"><a href="index.html">Home</a> - <a href="components.html">Components</a> 
            - <a href="howto.html">Howto Guides</a> - <a href="bestpractices.html">Best 
            Practices</a> - <a href="api/index.html">API Reference</a> - <a href="faq.html">FAQ</a> 
            - <a href="changes.html">News &amp; Changes History</a> - <a href="download.html">Download</a> 
            - <a href="support.html">Contact</a> - <a href="resources.html">Resources</a></font></p>
        </div>
      </td>
    </tr>
</table>
</body>
<!-- #EndTemplate --></html>

